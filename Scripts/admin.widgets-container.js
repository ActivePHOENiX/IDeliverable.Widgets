/// <reference path="typings/jquery/jquery.d.ts"/>
/// <reference path="typings/jquery/jqueryui.d.ts"/>
/// <reference path="typings/the-admin.d.ts"/>
var WidgetsContainer;
(function (WidgetsContainer) {
    $(function () {
        var removedWidgets = [];
        // Handle Add Widget button.
        $(".add-widget").on("click", function (e) {
            e.preventDefault();
            var hostId = $(this).data("host-id");
            var form = $(this).parents("form:first");
            var fieldset = $(this).parents("fieldset:first");
            var formActionValue = fieldset.find("input[name='submit.Save']");
            var url = $(this).attr("href");
            if (hostId === 0) {
                form.attr("action", url);
            }
            else {
                formActionValue.val("submit.Save");
                $("input[type='hidden'][name='returnUrl']").val(url);
            }
            form.submit();
        });
        // Handle Delete Widget button.
        $("div.widgets").on("click", "a.remove-widget", function (e) {
            e.preventDefault();
            if (!confirm($(this).data("confirm")))
                return;
            var li = $(this).parents("li:first");
            var widgetId = li.data("widget-id");
            li.remove();
            removedWidgets.push(widgetId);
            $("input[name='removedWidgets']").val(JSON.stringify(removedWidgets));
            updateWidgetPlacementField();
        });
        var updateWidgetPlacementField = function () {
            var widgetPlacementField = $("input[name='widgetPlacement']");
            var data = {
                zones: {}
            };
            $("div.widgets ul.widgets").each(function () {
                var zone = $(this).data("zone");
                data.zones[zone] = {
                    widgets: []
                };
                $(this).find("li").each(function () {
                    var widgetId = $(this).data("widget-id");
                    data.zones[zone].widgets.push(widgetId);
                });
            });
            var text = JSON.stringify(data);
            widgetPlacementField.val(text);
        };
        // Initialize sortable widgets.
        $("div.widgets ul.widgets").sortable({
            connectWith: "div.widgets ul.widgets",
            dropOnEmpty: true,
            placeholder: "sortable-placeholder",
            receive: function (e, ui) {
                updateWidgetPlacementField();
            },
            update: function (e, ui) {
                updateWidgetPlacementField();
            }
        });
        // Initialize Expando control
        $("#widgetsPlacement legend").expandoControl(function (controller) {
            return controller.nextAll(".expando");
        }, {
            collapse: true,
            remember: true });
    });
})(WidgetsContainer || (WidgetsContainer = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLndpZGdldHMtY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbIldpZGdldHNDb250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBLGtEQUFrRDtBQUNsRCxvREFBb0Q7QUFDcEQsOENBQThDO0FBRTlDLElBQU8sZ0JBQWdCLENBbUZ0QjtBQW5GRCxXQUFPLGdCQUFnQixFQUFDLENBQUM7SUFDckJBLENBQUNBLENBQUNBO1FBRUUsSUFBSSxjQUFjLEdBQUcsRUFBRSxDQUFDO1FBRXhCLDRCQUE0QjtRQUM1QixDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQW9CO1lBQ3ZELENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUNuQixJQUFJLE1BQU0sR0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzdDLElBQUksSUFBSSxHQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDakQsSUFBSSxRQUFRLEdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ3pELElBQUksZUFBZSxHQUFXLFFBQVEsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLENBQUMsQ0FBQztZQUN6RSxJQUFJLEdBQUcsR0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRXZDLEVBQUUsQ0FBQSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQSxDQUFDO2dCQUNiLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzdCLENBQUM7WUFDRCxJQUFJLENBQUEsQ0FBQztnQkFDRCxlQUFlLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUNuQyxDQUFDLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxHQUFHLENB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O0FBQ1BBLENBQUNBLEVBbkZNLGdCQUFnQixLQUFoQixnQkFBZ0IsUUFtRnRCIiwiZmlsZSI6ImFkbWluLndpZGdldHMtY29udGFpbmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvanF1ZXJ5L2pxdWVyeS5kLnRzXCIvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwidHlwaW5ncy9qcXVlcnkvanF1ZXJ5dWkuZC50c1wiLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvdGhlLWFkbWluLmQudHNcIi8+XHJcblxyXG5tb2R1bGUgV2lkZ2V0c0NvbnRhaW5lciB7XHJcbiAgICAkKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgdmFyIHJlbW92ZWRXaWRnZXRzID0gW107XHJcblxyXG4gICAgICAgIC8vIEhhbmRsZSBBZGQgV2lkZ2V0IGJ1dHRvbi5cclxuICAgICAgICAkKFwiLmFkZC13aWRnZXRcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZTogSlF1ZXJ5RXZlbnRPYmplY3QpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB2YXIgaG9zdElkOiBudW1iZXIgPSAkKHRoaXMpLmRhdGEoXCJob3N0LWlkXCIpO1xyXG4gICAgICAgICAgICB2YXIgZm9ybTogSlF1ZXJ5ID0gJCh0aGlzKS5wYXJlbnRzKFwiZm9ybTpmaXJzdFwiKTtcclxuICAgICAgICAgICAgdmFyIGZpZWxkc2V0OiBKUXVlcnkgPSAkKHRoaXMpLnBhcmVudHMoXCJmaWVsZHNldDpmaXJzdFwiKTtcclxuICAgICAgICAgICAgdmFyIGZvcm1BY3Rpb25WYWx1ZTogSlF1ZXJ5ID0gZmllbGRzZXQuZmluZChcImlucHV0W25hbWU9J3N1Ym1pdC5TYXZlJ11cIik7XHJcbiAgICAgICAgICAgIHZhciB1cmw6IHN0cmluZyA9ICQodGhpcykuYXR0cihcImhyZWZcIik7XHJcblxyXG4gICAgICAgICAgICBpZihob3N0SWQgPT09IDApe1xyXG4gICAgICAgICAgICAgICAgZm9ybS5hdHRyKFwiYWN0aW9uXCIsIHVybCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIGZvcm1BY3Rpb25WYWx1ZS52YWwoXCJzdWJtaXQuU2F2ZVwiKTtcclxuICAgICAgICAgICAgICAgICQoXCJpbnB1dFt0eXBlPSdoaWRkZW4nXVtuYW1lPSdyZXR1cm5VcmwnXVwiKS52YWwodXJsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9ybS5zdWJtaXQoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gSGFuZGxlIERlbGV0ZSBXaWRnZXQgYnV0dG9uLlxyXG4gICAgICAgICQoXCJkaXYud2lkZ2V0c1wiKS5vbihcImNsaWNrXCIsIFwiYS5yZW1vdmUtd2lkZ2V0XCIsIGZ1bmN0aW9uIChlOiBKUXVlcnlFdmVudE9iamVjdCkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICBpZighY29uZmlybSgkKHRoaXMpLmRhdGEoXCJjb25maXJtXCIpKSlcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBsaTogSlF1ZXJ5ID0gJCh0aGlzKS5wYXJlbnRzKFwibGk6Zmlyc3RcIik7XHJcbiAgICAgICAgICAgIHZhciB3aWRnZXRJZDogbnVtYmVyID0gbGkuZGF0YShcIndpZGdldC1pZFwiKTtcclxuXHJcbiAgICAgICAgICAgIGxpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICByZW1vdmVkV2lkZ2V0cy5wdXNoKHdpZGdldElkKTtcclxuICAgICAgICAgICAgJChcImlucHV0W25hbWU9J3JlbW92ZWRXaWRnZXRzJ11cIikudmFsKEpTT04uc3RyaW5naWZ5KHJlbW92ZWRXaWRnZXRzKSk7XHJcbiAgICAgICAgICAgIHVwZGF0ZVdpZGdldFBsYWNlbWVudEZpZWxkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVXaWRnZXRQbGFjZW1lbnRGaWVsZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHdpZGdldFBsYWNlbWVudEZpZWxkOiBKUXVlcnkgPSAkKFwiaW5wdXRbbmFtZT0nd2lkZ2V0UGxhY2VtZW50J11cIik7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgem9uZXM6IHt9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICQoXCJkaXYud2lkZ2V0cyB1bC53aWRnZXRzXCIpLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHZhciB6b25lOiBzdHJpbmcgPSAkKHRoaXMpLmRhdGEoXCJ6b25lXCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBkYXRhLnpvbmVzW3pvbmVdID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZGdldHM6IFtdXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcImxpXCIpLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0SWQ6IG51bWJlciA9ICQodGhpcykuZGF0YShcIndpZGdldC1pZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnpvbmVzW3pvbmVdLndpZGdldHMucHVzaCh3aWRnZXRJZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgdGV4dDogc3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XHJcbiAgICAgICAgICAgIHdpZGdldFBsYWNlbWVudEZpZWxkLnZhbCh0ZXh0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBJbml0aWFsaXplIHNvcnRhYmxlIHdpZGdldHMuXHJcbiAgICAgICAgJChcImRpdi53aWRnZXRzIHVsLndpZGdldHNcIikuc29ydGFibGUoe1xyXG4gICAgICAgICAgICBjb25uZWN0V2l0aDogXCJkaXYud2lkZ2V0cyB1bC53aWRnZXRzXCIsXHJcbiAgICAgICAgICAgIGRyb3BPbkVtcHR5OiB0cnVlLFxyXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogXCJzb3J0YWJsZS1wbGFjZWhvbGRlclwiLFxyXG4gICAgICAgICAgICByZWNlaXZlOiBmdW5jdGlvbihlLCB1aSl7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVXaWRnZXRQbGFjZW1lbnRGaWVsZCgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKGUsIHVpKXtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVdpZGdldFBsYWNlbWVudEZpZWxkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBFeHBhbmRvIGNvbnRyb2xcclxuICAgICAgICAkKFwiI3dpZGdldHNQbGFjZW1lbnQgbGVnZW5kXCIpLmV4cGFuZG9Db250cm9sKFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoY29udHJvbGxlcikgeyBcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9sbGVyLm5leHRBbGwoXCIuZXhwYW5kb1wiKTsgfSwgeyBcclxuICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZTogdHJ1ZSwgXHJcbiAgICAgICAgICAgICAgICAgICAgcmVtZW1iZXI6IHRydWUgfSk7XHJcbiAgICB9KTtcclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
